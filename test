import { NavigationEnd, Router } from '@angular/router';
import { filter } from 'rxjs/operators';

export class PageHeaderComponent implements OnInit {
  @Input() public currentCount: number | undefined;

  protected tabs: Tab[] = Object.values(Tab);
  protected activeTab: Tab = this.tabs[0];

  private readonly tabUrls: Map<Tab, string> = new Map<Tab, string>()
    .set(Tab.SOLICITING, 'ticket-list')
    .set(Tab.MY_TEAM, 'ticket-list/team-list');

  public constructor(
    private readonly router: Router,
    private readonly jwtService: JwtService,
    private readonly metabotBridge: MetabotBridgeService
  ) {}

  public ngOnInit(): void {
    this.router.events
      .pipe(filter(event => event instanceof NavigationEnd))
      .subscribe(() => this.setActiveTabFromUrl());

    // appel initial
    this.setActiveTabFromUrl();
  }

  private setActiveTabFromUrl(): void {
    const found = Array.from(this.tabUrls.entries()).find(([tab, url]) =>
      this.router.url.includes(url)
    );
    if (found) {
      this.activeTab = found[0];
    }
  }
}
