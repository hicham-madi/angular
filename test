import { NavigationEnd, Router } from '@angular/router';
import { filter } from 'rxjs/operators';

export class PageHeaderComponent implements OnInit {
  @Input() public currentCount: number | undefined;

  protected tabs: Tab[] = Object.values(Tab);
  protected activeTab: Tab = this.tabs[0];

  private readonly tabUrls: Map<Tab, string> = new Map<Tab, string>()
    .set(Tab.SOLICITING, 'ticket-list')
    .set(Tab.MY_TEAM, 'ticket-list/team-list');

  public constructor(
    private readonly router: Router,
    private readonly jwtService: JwtService,
    private readonly metabotBridge: MetabotBridgeService
  ) {}

  public ngOnInit(): void {
    this.router.events
      .pipe(filter(event => event instanceof NavigationEnd))
      .subscribe(() => this.setActiveTabFromUrl());

    // appel initial
    this.setActiveTabFromUrl();
  }

  private setActiveTabFromUrl(): void {
    const found = Array.from(this.tabUrls.entries()).find(([tab, url]) =>
      this.router.url.includes(url)
    );
    if (found) {
      this.activeTab = found[0];
    }
  }
}    );
    if (match) {
      this.activeTab = match[0];
    }
  }

  protected showBadge(tab: string): boolean {
    return tab === Tab.SOLICITING;
  }

  protected goToCreate(): void {
    this.maximize();
    this.router.navigate(['/ticket-create/new']);
  }

  protected handleTabClick(tab: Tab): void {
    this.activeTab = tab;
    this.maximize();
  }

  private maximize(): void {
    this.metabotBridge.maximize();
  }
}

<div class="uk-grid uk-grid-collapse uk-child-width-auto">
  <ng-container *ngFor="let tab of tabs; trackBy: trackTab">
    <button
      class="text-button tab border-none no-radius padding-small"
      [ngClass]="{ 'active-tab': tab === activeTab }"
      (click)="handleTabClick(tab)"
    >
      <div>{{ tab }}</div>
      <ng-container *ngIf="showBadge(tab)">
        <span class="uk-margin-small-left sticker-canard-moyen sticker-padding">
          {{ currentCount }}
        </span>
      </ng-container>
    </button>
  </ng-container>

  <div class="uk-width-expand uk-text-right padding-small tab">
    <button class="canard-fonce-button" (click)="goToCreate()">
      <span class="material-symbols-outlined">add_box</span>
      <div>nouvelle sollicitation</div>
    </button>
  </div>
</div>
