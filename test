@Output() public loadMore = new EventEmitter<{ sortKey: string|null; isAsc: boolean|null }>();

public onCdkScroll(): void {
  const end = this.cdkVirtualScroll.getRenderedRange().end;
  const total = this.cdkVirtualScroll.getDataLength();
  const pageSize = 20;

  // seuil simple : on est “au bout” de la page visible
  const threshold = Math.ceil(total / pageSize) * pageSize;

  if (end >= threshold - 2) {
    // debug temporaire
    console.log('[table] loadMore emit', { end, total, threshold, hasPending: this.hasPendingPage });

    if (this.hasPendingPage) {
      this.loadMore.emit({
        sortKey: this.sort.direction ? this.sort.active : null,
        isAsc:   this.sort.direction ? this.sort.direction === 'asc' : null,
      });
    }
  }
}
