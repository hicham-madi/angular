export class SolicitingsTableComponent {
  // ...

  private lastDataLength = 0;
  private scrollLocked = false;

  public ngOnChanges(): void {
    const len = this.tickets?.length ?? 0;
    if (len !== this.lastDataLength) {
      this.lastDataLength = len;

      // âœ… RÃ‰ARMER le dÃ©clenchement pour la page suivante
      this.scrollLocked = false;

      // (Optionnel) si tu gardes cette logique :
      // this.lastTriggerEnd = -1;
    }
  }

  public onCdkScroll(): void {
    if (!this.hasPendingPage) return;
    if (this.loadingNextPage) return;
    if (this.scrollLocked) return;

    const end = this.viewport.getRenderedRange().end;
    const total = this.viewport.getDataLength();
    const atBottom = end >= total - 1; // ou ton preloadOffset

    if (atBottom) {
      this.scrollLocked = true; // ðŸ”’ on bloque immÃ©diatement
      this.loadMore.emit({
        sortKey: this.sort?.active ?? null,
        isAsc: this.sort?.direction === 'asc' ? true : this.sort?.direction === 'desc' ? false : null,
      });
    }
  }
}

