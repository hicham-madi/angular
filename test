// TicketsPageBase (ou le composant concret)
private ignoreCardOnce = false;

protected onHeaderTabClick(): void {
  const next = this.currentTab === 'ongoing' ? 'completed' : 'ongoing';

  // Demander au listener de card d’ignorer la prochaine valeur
  this.ignoreCardOnce = true;

  // Réinitialisations locales (si besoin)
  this.activeCard = null!;
  localStorage.removeItem('lastSelectedCard');
  this.resetPagination();

  // Navigation: change le tab et SUPPRIME ?card=... de l’URL
  this.router.navigate([], {
    relativeTo: this.route,
    queryParams: { tab: next, card: null }, // null => suppression
    queryParamsHandling: 'merge',
    replaceUrl: true
  });
}

// À un seul endroit (évite les doubles subs)
this.route.queryParamMap
  .pipe(
    map(p => p.get('card') as FilterCardType | null),
    distinctUntilChanged()
  )
  .subscribe(cardType => {
    // Si on vient de cliquer sur l’onglet, on ignore UNE fois la valeur de 'card'
    if (this.ignoreCardOnce) {
      this.ignoreCardOnce = false;
      return;
    }
    if (cardType && this.activeCard !== cardType) {
      this.onCardClicked(cardType);
    }
  });
