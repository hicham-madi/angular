<div class="table-scroll-wrapper uk-flex uk-flex-column">
  <!-- TABLE SCROLLABLE AVEC HEADERS -->
  <cdk-virtual-scroll-viewport
    itemSize="50"
    class="cdk-height"
    (scrolledIndexChange)="onCdkScroll()"
  >
    <table mat-table [dataSource]="tickets" class="mat-elevation-z8 h-100 full-width">
      
      <!-- DÃ©finition dynamique des colonnes -->
      <ng-container *ngFor="let column of displayedColumns" [matColumnDef]="column">
        
        <!-- Header -->
        <th
          mat-header-cell
          *matHeaderCellDef
          class="column-align"
          [ngStyle]="columnConfig[column]?.style || {}"
        >
          <ng-container *ngIf="column !== 'slabLabel' && column !== 'domainLabel'; else htmlLabel">
            {{ columnConfig[column]?.label || column }}
          </ng-container>
          <ng-template #htmlLabel>
            <span
              class="column-label"
              [innerHTML]="columnConfig[column]?.label || column"
            ></span>
          </ng-template>
          <ng-container *ngIf="column === 'action'">
            <mat-icon
              class="sort-icon"
              fontIcon="{{ getSortIcon(column) }}"
            ></mat-icon>
          </ng-container>
        </th>

        <!-- Cellule -->
        <td
          mat-cell
          *matCellDef="let row"
          [ngStyle]="columnConfig[column]?.style || {}"
        >
          <ng-container
            *ngTemplateOutlet="columnTemplates[column]; context: { $implicit: row }"
          ></ng-container>
        </td>
      </ng-container>

      <!-- Header et Row -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        [class.readCustomer]="isReadCustomer(row)"
        (click)="rowClick?.(row)"
      ></tr>
    </table>
  </cdk-virtual-scroll-viewport>
</div>
