<div class="table-scroll-wrapper">
  <cdk-virtual-scroll-viewport
    itemSize="50"
    class="cdk-height"
    (scrolledIndexChange)="onCdkScroll()"
  >
    <table mat-table [dataSource]="tickets" class="mat-elevation-z8">

      <!-- Colonnes dynamiques -->
      @for (column of displayedColumns; track column) {
        <ng-container [matColumnDef]="column">
          
          <!-- Header sticky -->
          <th
            mat-header-cell
            *matHeaderCellDef
            sticky
            class="column-align"
            [ngStyle]="columnConfig[column]?.style || {}"
            (click)="sortData(column)"
          >
            @if (column !== 'slaLabel' && column !== 'domainLabel') {
              {{ columnConfig[column]?.label || column }}
            } @else {
              <span class="column-label" [innerHTML]="columnConfig[column]?.label || column"></span>
            }

            @if (column !== 'action') {
              <mat-icon class="sort-icon" fontIcon="{{ getSortIcon(column) }}"></mat-icon>
            }
          </th>

          <!-- Cellule -->
          <td
            mat-cell
            *matCellDef="let row"
            [ngStyle]="columnConfig[column]?.style || {}"
          >
            @if (columnTemplates[column]) {
              <ng-container
                *ngTemplateOutlet="columnTemplates[column]; context: { $implicit: row }"
              ></ng-container>
            }
          </td>
        </ng-container>
      }

      <!-- Ligne header -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns" sticky></tr>

      <!-- Ligne data -->
      <tr
        mat-row
        *matRowDef="let row; columns: displayedColumns"
        [class.readCustomer]="isReadCustomer(row)"
        (click)="rowClick(row)"
      ></tr>
      
    </table>
  </cdk-virtual-scroll-viewport>
</div>
@import 'common'; // si tu as un fichier commun pour fonts/couleurs

:host {
  display: block;
}

.table-scroll-wrapper {
  max-height: 70vh;
  overflow-y: auto;
  overflow-x: hidden;
  border: 1px solid $text-border; // facultatif
  border-radius: 8px;
}

cdk-virtual-scroll-viewport {
  height: 100%;
  display: block;
}

table {
  width: 100%;
  table-layout: fixed;

  th.mat-header-cell,
  td.mat-cell {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    padding: 8px 12px;
    font-family: 'Montserrat', sans-serif;
  }

  th.mat-header-cell {
    background-color: $text-background;
    color: $text-primary;
    font-weight: 600;
    font-size: 14px;
    position: sticky;
    top: 0;
    z-index: 2;
    border-bottom: 1px solid $text-border;
  }

  td.mat-cell {
    font-size: 13px;
    font-weight: 400;
    border-bottom: 1px solid $text-border;
  }

  tr.mat-row:hover td.mat-cell {
    background-color: rgba(0, 0, 0, 0.02);
    transition: background-color 0.2s ease;
  }

  tr.mat-row.readCustomer td {
    background-color: rgba(238, 248, 246, 1);
    font-weight: 600;
  }
}

.sort-icon {
  margin-left: 5px;
  vertical-align: middle;
  font-size: 18px;
}

.column-align {
  text-align: left;
}

.column-label {
  line-height: 1.4;
}
