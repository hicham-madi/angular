public class TicketMetadataExtractor {

    public static TicketMetadata extractFrom(List<Ticket> tickets) {
        Set<String> statuses = new HashSet<>();
        Set<String> agencies = new HashSet<>();
        Set<String> collaborators = new HashSet<>();
        Set<String> campaigns = new HashSet<>();
        boolean hasToBeClosed = false;

        for (Ticket ticket : tickets) {
            if (ticket.getStatus() != null) statuses.add(ticket.getStatus());
            if (ticket.getAgency() != null) agencies.add(ticket.getAgency());
            if (ticket.getCollaborator() != null) collaborators.add(ticket.getCollaborator());
            if (ticket.getCampaign() != null) campaigns.add(ticket.getCampaign());
            if (!hasToBeClosed && Boolean.TRUE.equals(ticket.getGetToBeClosed())) {
                hasToBeClosed = true;
            }
        }

        if (hasToBeClosed) {
            statuses.add("TO_BE_CLOSED");
        }

        return new TicketMetadata(statuses, agencies, collaborators, campaigns);
    }

    public record TicketMetadata(
        Set<String> statusList,
        Set<String> agencyList,
        Set<String> collaboratorsList,
        Set<String> campaignsList
    ) {}
}

TicketMetadataExtractor.TicketMetadata metadata = TicketMetadataExtractor.extractFrom(tickets);


.statusList(metadata.statusList())
.agencyList(metadata.agencyList())
.collaboratorsList(metadata.collaboratorsList())
.campaignsList(metadata.campaignsList())
